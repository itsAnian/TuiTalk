# syntax=docker/dockerfile:1.4
FROM rust:bookworm AS builder

WORKDIR /usr/src/app

RUN rustup target add wasm32-unknown-unknown \
    && cargo install trunk

COPY Cargo.toml Cargo.lock ./
COPY shared ./shared
COPY wasm-client ./wasm-client
COPY client ./client
COPY ws-server ./ws-server

WORKDIR /usr/src/app/wasm-client

RUN trunk build --release

FROM nginx:alpine

COPY --from=builder /usr/src/app/wasm-client/dist /usr/share/nginx/html

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
